## 비트코인 vs 이더리움
#### 비트코인의 한계점
```
1) 비트코인 스크립트 언어의 단점  
- 튜링 불완전성: 아주 단순하고 표현방법이 많지 않은 언어 (while, loop 명령이 제외됨)
- Value-blindness: UTXO(Unspent Transaction Outputs: 사용되지 않은 비트코인(잔액) 덩어리)는 input, output 2가지 밖에 못 함, 화폐의 기능 이외의 다른 분야의 App을 만드는데 한계가 있음
- Lack of state(상태표현제한): 비트코인의 UTXO가 표현할 수 있는 상태는 사용했거나 안했거나 둘 중 하나인데, 그렇기 때문에 이 2가지 상태 이외에 다른 어떤 조건에서 UTXO를 전부 사용하지 않고 나눠서 사용하는 계약을 할 수 없음
2) 작업증명방식의 합의 매커니즘
- 지나치게 큰 에너지 소모
- 채굴자들의 중앙화
3) 늦은 거래처리속도
4) 의사결정 구조
- hard fork (하드포크: 기존 블록체인과 호환되지 않는 새로운 블록체인에서 다른 종류의 가상화폐를 만드는 것, 블록체인 프로토콜이 어느 한 시점에서 급격하게 변경되는 것)
- Segwit (세그윗: 서명을 거래 정보와 같이 저장하는 것이 아니라 따로 저장하는 방식)
```

#### 비트코인 vs 이더리움    
| 비트코인 | 이더리움 |  
|-----|-----|  
| 화폐 역할을 하는 어플 | 다양한 서비스가 가능한 스마트폰이자 플랫폼|   

![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum0.png?raw=true)

## 이더리움
1. 비트코인의 단점을 보완하는 새로운 블록체인 플랫폼
2. 상태와 데이터 저장이 가능함 (반복문 실행 가능)
3. 튜링 완전 언어(Solidity, Go, C++, LLL 등)를 이용하여 스마트 컨트랙트 생성
4. 만들어진 스마트 컨트랙트는 DApp으로 블록체인을 통해 배포 및 실행 

> #### 용어 설명
> - Smart Contract(스마트 컨트랙트): 온라인상에서 특정 계약 조건을 이행하는 것 
> - DApp(Decentralized Application: 디앱): 분산 어플리케이션
> - GAS: 이더리움 내의 수수료, 이더리움 플랫폼에는 이더(Ether)라는 자체 암호화 화폐토큰이 있고 이더를 가지고 가스라는 어플리케이션을 구입하여 계좌 간 송금 또는 스마트 컨트랙트 사용, 이더리움의 자원을 사용하는 경우에 ‘연료’로써 쓰임 (GAS를 지불) 

#### 스마트 컨트랙트(스마트 계약)
: 스마트 컨트랙트를 통해 온라인에서 특정 계약조건을 실행한다. 즉,스마트 컨트랙트가 코드로써 블록체인 상에 기록되기 때문에 한번 배포된 스마트 컨트랙트는 수정이 불가능하며, 구현된 함수에서 특정 조건을 만족시키면, 1) 자동적으로  2) 무조건 실행
   
#### 이더리움 계층구조
![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum1.png?raw=true)
    1) Hardware layer: geth 또는 metamask, miner들을 통해 접속하는 이더리움 네트워크
    2) Software layer: Solidity, 스마트 컨트랙트 layer (스마트 컨트랙트 전용 언어들을 활용해 작성)
    3) Application layer: DApp

#### 이더리움 개념: A transaction-based state machine  

![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum2.png?raw=true)  
- 네트워크 트랜잭션이 발생하기 전(Genesis state)에서 시작하여 트랜잭션이 실행되면 Final state로 전환
- 어느 한 시점에서 Final state는 이더리움 네트워크의 현재 상태(Current state)를 나타냄

![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum3.png?raw=true)  
- 하나의 블록이 state를 나타내는 것이 아님
- 값이 변경, 블록 생성 등의 변화가 있는 경우 새로운 state로 업데이트 

![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum4.png?raw=true)  
- Final state에서 다음 state로 전환하기 위해서는 트랜잭션 유효성 검사(Mining)를 해야 함
- Mining: Miner 노드가 Compute resource를 투입하여 유효한 블록을 생성하는 경우  
(신규 블록을 체인에 추가하고 거래가 참인지 거짓인지 확인하는 과정)
- block header에 부모 블록의 Hash가 기록되므로 블록이 Chain처럼 연결됨

```
- 이더리움 네트워크에서는 누구든 채굴자 노드가 되어 블록을 생성하고 입증하는 시도를 할 수 있으며, 이 작업은 채굴을 시도하는 모든 노드에서 동시에 이루어짐
    - 그리고 각 각의 채굴자들은 블록체인에 블록을 제출할 때 수학적인 증거를 제시하며, 이는 일종의 보증서(guarantee : 만약에 증거가 존재한다면 블록은 반드시 유효하다)로서 동작
    - 블록을 메인 블록체인에 올리기 위해서 채굴자는 반드시 다른 채굴자보다 빨리 이를 증명해야 함
    - 이렇게 채굴자가 수학적 증거를 제공함으로써 각각의 블록을 증명하는 과정을 PoW(Proof of Work: 작업 증명 방식)라고 부름
      ⇒ PoW: 네트워크에 참여하는 모든 노드는 블록 생성의 권한을 가진다. 블록은 거래 내역들을 담고 있기 때문에 블록을 생성한다는 것은 해당 블록 내에 기록된 거래 내역들이 입증됐음을 의미한다. 블록을 생성하기 위해서는 특정한 난이도의 해시값을 구하는 수학적연산을 수행해야 한다.
    - 새로운 블록을 증명한 채굴자는 일정한 양의 보상을 받게 됨 (보상은 이더(Ether), 블록을 이어 붙일 때 새로운 이더를 함께 생성하고 이를 보상으로 가져감)
```

#### 이더리움 상태변화

![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum5.png?raw=true)  
    - s[0]: 블록을 만들기 전 상태
    - Tx[0]~Tx[n]: 거래 내용 ⇒ 거래 내용에 대한 변경 내용을 모두 apply 해서 업데이트를 하고, 이에 따라 변경된 각 계정의 balance를 기록함
    - 최종적으로 마이닝이 성공하면 S_FINAL 상태의 Account 내용을 블록에 담고, 이더리움 네트워크에 broadcasting 함 
    
    ∙엉클블록
  : 블록생성에 성공하였고 검증에 오류가 없어서 이더리움 네트워크를 통해 다른 노드에 브로드캐스팅은 되었으나, 메인 체인으로 채택되지 못한 블록들
  ∘엉클블록이 많아지면 생기는 문제점
    - 트랜잭션 처리를 지연시킴: 동시에 두 마이너가 블록을 생성한다면 마이너들에게는 서로 다른 트랜잭션이 포함하지만 엉클블록에 포함된 트랜잭션은 처리되지 않기 때문에 처리속도가 늦어짐
    - 컴퓨팅 파워 낭비: 엉클블록의 생성과정은 불필요한 해시계산을 위한 컴퓨팅 파워를 쓴 결과
    - 보안문제: 블록체인의 폭이 넓어지고, 자칫 컴퓨팅 파워가 강한 마이너에 의해 블록체인이 악의적으로 변경되는 문제 발생 가능

#### 이더리움 구성요소 – Ghost 프로토콜
![](https://github.com/aldrn29/Blockchain/blob/master/image/ethereum6.png?raw=true)  
  ∘Long Range Attack
    - Ghost 프로토콜이라는 매커니즘을 도입하여 가장 큰 무게를 가진 subTree를 선택함
    - Difficulty가 가장 높은블록, 가장 최신의 블록넘버를 가진 경로(계산을 많이 수행한 경로)를 선택함
    - 블록 넘버가 높을수록 경로가 길어지고, 그만큼 difficulty가 상승함
    

#### Ghost 프로토콜
    : 채굴에 성공했지만, 난이도가 더 높은 다른 신규 블록에 의해 버려지는 블록에게도 소정의 보상을 하는 방식 (비트코인에서는 고아 블록이라고 부르며 아무런 보상도 주지 않음)
    ⇒ 이더리움은 Ghost 프로토콜을 통해서 블록 생성을 상대적으로 빠르게 하고, 트랜잭션 처리율을 100%에 가깝게 유지하면서 보안성까지 지킬 수 있게 됨
